#define pr_fmt(fmt) "%s: " fmt, "nullderef"

#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/module.h>
#include <linux/errno.h>

MODULE_AUTHOR("Frederick Lawler <me@fred.software>");
MODULE_DESCRIPTION("Causes a null pointer deference panic.");
MODULE_LICENSE("GPL");

static int __init nullderef_init(void)
{
    int *p = 0;
    pr_info("module init\n");
#ifdef CRASH
	pr_warn("null pointer deref happening...\n");
	pr_warn("null deref: %d\n", *p);
#else
    pr_info("not going to crash\n");
#endif
	return 0;
}

static void __exit nullderef_exit(void)
{
	pr_info("unloaded module\n");
}

module_init(nullderef_init);
module_exit(nullderef_exit);
